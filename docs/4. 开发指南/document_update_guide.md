# 文档自动更新指南

本指南介绍如何使用文档自动更新脚本，该脚本能在代码变更时自动更新项目的开发进度表和相关技术文档。

## 功能概述

文档自动更新脚本具有以下功能：

1. **自动追踪代码变更**：通过Git提交信息分析代码变更影响的模块
2. **更新开发进度表**：根据代码变更自动更新各模块的完成度
3. **记录进度更新历史**：在开发进度表中添加更新记录
4. **更新相关技术文档**：根据代码变更自动更新相关技术文档的更新记录

## 安装步骤

### 方法一：通过npm脚本安装（推荐）

项目已配置npm脚本，可通过以下命令轻松安装Git钩子：

```bash
npm run install-hooks
```

该命令将会：
- 确保文档更新脚本具有执行权限
- 创建Git post-commit钩子
- 设置钩子的执行权限

### 方法二：手动安装

如果自动安装失败，可以按以下步骤手动安装：

1. 确保文档更新脚本具有执行权限：
   ```bash
   chmod +x scripts/update-docs.js
   ```

2. 创建Git post-commit钩子文件：
   ```bash
   touch .git/hooks/post-commit
   ```

3. 编辑钩子文件，添加以下内容：
   ```bash
   #!/bin/sh
   # 自动文档更新钩子
   # 在每次提交后运行文档更新脚本
   
   # 获取项目根目录
   ROOT_DIR=$(git rev-parse --show-toplevel)
   
   # 运行文档更新脚本
   node ${ROOT_DIR}/scripts/update-docs.js
   
   exit 0
   ```

4. 设置钩子文件的执行权限：
   ```bash
   chmod +x .git/hooks/post-commit
   ```

## 使用方法

### 自动更新（推荐）

一旦安装了Git钩子，文档会在每次代码提交后自动更新。无需手动干预。

代码提交流程：
1. 编写代码，添加和修改文件
2. 使用`git add`添加变更文件
3. 使用`git commit`提交变更
4. 提交完成后，钩子会自动运行文档更新脚本
5. 文档自动更新完成

### 手动更新

如果需要手动更新文档（例如，钩子未触发或需要立即更新），可以使用以下命令：

```bash
npm run update-docs
```

## 配置说明

文档自动更新脚本的配置位于`scripts/update-docs.js`文件的顶部。主要配置项包括：

1. **模块路径映射**：定义了代码路径与项目模块的对应关系
   ```javascript
   modulePathMapping: {
       'src/components': '前端开发',
       'src/pages': '前端开发',
       // 更多映射...
   }
   ```

2. **文档模块映射**：定义了项目模块与相关技术文档的对应关系
   ```javascript
   docModuleMapping: {
       '前端开发': ['docs/2. 系统设计/ui-design.md', 'docs/3. 技术规范/frontend-guidelines.md'],
       // 更多映射...
   }
   ```

如需修改或扩展配置，请直接编辑`scripts/update-docs.js`文件中的相应部分。

## 进度计算逻辑

脚本使用以下逻辑计算和更新进度：

1. 每次提交默认为相关模块增加5%的进度（上限为100%）
2. 总体进度通过计算所有模块的平均进度得出
3. 进度表中会记录每次更新的日期、作者、提交消息和影响的模块

## 注意事项

1. 脚本依赖Git提交信息，确保使用有意义的提交消息
2. 如果发现进度计算不准确，可以手动编辑开发进度表
3. 在多人协作环境中，每个开发者都需要安装Git钩子
4. 如更改了项目结构，记得更新脚本中的路径映射配置

## 故障排除

如果遇到以下问题，请尝试相应的解决方案：

1. **钩子未触发**：
   - 检查.git/hooks/post-commit文件是否存在且具有执行权限
   - 尝试重新安装钩子：`npm run install-hooks`

2. **脚本报错**：
   - 检查Node.js是否正确安装
   - 确保package.json中的依赖已安装完成
   - 查看错误消息，根据具体情况调整配置

3. **进度未更新**：
   - 确认代码变更路径在modulePathMapping中有定义
   - 检查开发进度表格式是否与脚本预期一致
   - 尝试手动运行更新脚本：`npm run update-docs`

## 维护与扩展

随着项目的发展，可能需要对自动更新脚本进行维护或扩展。常见的维护工作包括：

1. 更新模块路径映射，以匹配项目结构变化
2. 添加新的文档到文档模块映射中
3. 调整进度计算逻辑，使其更符合项目实际情况

如需进行这些修改，请更新`scripts/update-docs.js`文件，并确保更改后的脚本能够正常工作。 